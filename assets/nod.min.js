function nod(e){function n(e){var n=Array.isArray(e)?e:[e];n.forEach(function(e){var n,r;if(Array.isArray(e.validate)){if(!Array.isArray(e.errorMessage))throw'If you pass in `validate:...` as an array, then `errorMessage:...` also needs to be an array. "'+e.validate+'", and "'+e.errorMessage+'"';n=e.validate,r=e.errorMessage,n.forEach(function(n,o){e.validate=n,e.errorMessage=r[o],t(e)})}else t(e)})}function t(e){function n(e,n){var t=nod.getElements(n);t.forEach(function(n){var t=x.findOrMake(n,m,null,l);e.subscribeTo(t.id)})}var t=[],r=nod.getCheckFunction(e),o=nod.getElements(e.selector),s=o.map(function(n){return{listener:x.findOrMake(n,m,e.triggerEvents,l),checker:h.findOrMake(n,m),checkHandler:g.findOrMake(n,m,l),domNode:p.findOrMake(n,m,l)}});r.validate="function"==typeof e.validate?e.validate.toString():e.validate,("one-of"===e.validate||"only-one-of"===e.validate||"some-radio"===e.validate)&&t.push(e.selector),"string"==typeof e.validate&&e.validate.indexOf("same-as")>-1&&t.push(e.validate.split(":")[1]),s.forEach(function(o){o.checker.subscribeTo(o.listener.id),n(o.checker,e.triggeredBy),n(o.checker,t);var s=nod.unique();o.checker.addCheck(r,s),o.checkHandler.subscribeTo(s,e.errorMessage,e.defaultStatus),l.noDom?v.subscribe(o.checkHandler.id):o.domNode.subscribeTo(o.checkHandler.id)}),i()}function r(e){var n=nod.getElement(e);n.addEventListener("submit",o,!1)}function o(e){if(l.preventSubmit&&!c(nod.constants.VALID)){e.preventDefault(),h.forEach(function(n){n.performCheck({event:e})});for(var n=0,t=g.length;t>n;n++){var r=g[n];if(r.getStatus().status===nod.constants.INVALID){r.element.focus();break}}}}function s(e){var n=nod.getElements(e);n.forEach(function(e){x.removeItem(e),h.removeItem(e),g.removeItem(e),p.removeItem(e)})}function a(e,n){if(arguments.length>1){var t=e;e={},e[t]=n}for(var o in e)l[o]=e[o];(e.submit||e.disableSubmit)&&i(),e.form&&r(e.form)}function i(){l.submit&&l.disableSubmit&&(nod.getElement(l.submit).disabled=!c(nod.constants.VALID))}function c(e){for(var n=0,t=g.length;t>n;n++)if(g[n].getStatus().status!==e)return!1;return!0}function u(e){var n=nod.getElements(e.selector);n.forEach(function(n){var t=p.findOrMake(n);t.setMessageOptions(e.parent,e.errorSpan)})}function d(e,n){var t=nod.getElement(e),r=g.findOrMake(t).getStatus();return n?r:r.status}function f(e){var n=e?nod.getElements(e).map(h.findOrMake):h;n.forEach(function(e){e.performCheck()})}var l={},m=nod.makeMediator(),v=nod.makeEventEmitter(m),x=nod.makeCollection(nod.makeListener),h=nod.makeCollection(nod.makeChecker),g=nod.makeCollection(nod.makeCheckHandler),p=nod.makeCollection(nod.makeDomNode);m.subscribe("all",i),m.subscribe("all",function(e){"function"==typeof l.tap&&"check"===e.type&&l.tap(e)});var C={add:n,remove:s,areAll:c,getStatus:d,configure:a,setMessageOptions:u,performCheck:f};return e&&C.configure(e),C}nod.constants={VALID:"valid",INVALID:"invalid",UNCHECKED:"unchecked"},nod.classes={successClass:"nod-success",successMessageClass:"nod-success-message",errorClass:"nod-error",errorMessageClass:"nod-error-message"},nod.unique=function(){var e=0;return function(){return e++}}(),nod.makeMediator=function(){var e=[],n=[];return{subscribe:function(t,r){"all"===t?n.push(r):(e[t]||(e[t]=[]),-1===e[t].indexOf(r)&&e[t].push(r))},fire:function(t){var r=e[t.id].concat(n);r.forEach(function(e){e(t)})}}},nod.findCollectionIndex=function(e,n){for(var t in e)if(e[t].element===n)return t;return-1},nod.makeCollection=function(e){var n=[];return n.findOrMake=function(t){var r=nod.findCollectionIndex(n,t);if(-1!==r)return n[r];var o=e.apply(null,arguments);return n.push(o),o},n.removeItem=function(e){var t=nod.findCollectionIndex(n,e),r=n[t];r&&("function"==typeof r.dispose&&r.dispose(),n.splice(t,1))},n},nod.makeListener=function(e,n,t,r){function o(e){n.fire({id:i,event:e,type:"change"})}function s(){e.removeEventListener("input",o,!1),e.removeEventListener("change",o,!1),e.removeEventListener("blur",o,!1),a&&a.off(),t&&t.forEach(function(n){e.removeEventListener(n,o,!1)})}var a,i=nod.unique();return e.addEventListener("input",o,!1),e.addEventListener("change",o,!1),e.addEventListener("blur",o,!1),r.jQuery&&(a=r.jQuery(e),a.on("propertychange change click keyup input paste",o)),t&&(t=Array.isArray(t)?t:[t],t.forEach(function(n){e.addEventListener(n,o,!1)})),{element:e,dispose:s,id:i}},nod.makeChecker=function(e,n){function t(e){n.subscribe(e,r)}function r(e){s.forEach(function(n){n(e||{})})}function o(t,r){function o(o){n.fire({id:r,type:"check",result:o,element:e,validate:t.validate})}s.push(function(n){var r=void 0!==e.value?e.value:e.innerHTML;n.element=e,t(o,r,n)})}var s=[];return{subscribeTo:t,addCheck:o,performCheck:r,element:e}},nod.makeCheckHandler=function(e,n){function t(e,t,o){a[e]||(a[e]={status:o||nod.constants.UNCHECKED,errorMessage:t}),n.subscribe(e,r)}function r(e){a[e.id].status=e.result?nod.constants.VALID:nod.constants.INVALID,o()}function o(){var t=s();n.fire({id:i,type:"result",result:t.status,element:e,errorMessage:t.errorMessage})}function s(){var e,n;for(var t in a)if(e=a[t].status,a[t].status===nod.constants.INVALID){n=a[t].errorMessage;break}return{status:e,errorMessage:n}}var a={},i=nod.unique();return{id:i,subscribeTo:t,checkHandler:r,getStatus:s,element:e}},nod.hasClass=function(e,n){return!!n.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))},nod.removeClass=function(e,n){nod.hasClass(e,n)&&(n.className=n.className.replace(new RegExp("(\\s|^)"+e+"(\\s|$)"),""))},nod.addClass=function(e,n){nod.hasClass(e,n)||(n.className+=" "+e)},nod.getParent=function(e,n){var t=n.parentClass;return t?(t="."===t.charAt(0)?t.slice(1):t,nod.findParentWithClass(e.parentNode,t)):e.parentNode},nod.findParentWithClass=function(e,n){return e.parentNode?nod.hasClass(n,e)?e:nod.findParentWithClass(e.parentNode,n):e},nod.makeDomNode=function(e,n,t){function r(e){var n=t.successClass||nod.classes.successClass,r=t.errorClass||nod.classes.errorClass;switch(e){case nod.constants.VALID:nod.removeClass(r,u),nod.addClass(n,u);break;case nod.constants.INVALID:nod.removeClass(n,u),nod.addClass(r,u)}}function o(e,n){var r=t.successMessageClass||nod.classes.successMessageClass,o=t.errorMessageClass||nod.classes.errorMessageClass;switch(l.style.display="none",e){case nod.constants.VALID:nod.removeClass(o,l),nod.addClass(r,l),t.successMessage&&(l.textContent=t.successMessage,l.style.display="");break;case nod.constants.INVALID:nod.removeClass(r,l),nod.addClass(o,l),l.textContent=n,l.style.display=""}}function s(e){var n=e.result,s=e.errorMessage;d===nod.constants.INVALID||0===t.delay?(d=n,r(n),o(n,s)):(clearTimeout(f),f=setTimeout(function(){d=n,r(n),o(n,s),f=null},t.delay||700))}function a(e){n.subscribe(e,s)}function i(e,n){e&&(u=nod.getElement(e)),n&&(l.parentNode.removeChild(l),l=nod.getElement(n),m=!0)}function c(){nod.removeClass(t.errorClass||nod.classes.errorClass,u),nod.removeClass(t.successClass||nod.classes.successClass,u),m||l.parentNode.removeChild(l)}var u=nod.getParent(e,t),d=nod.constants.UNCHECKED,f=null,l=document.createElement("span"),m=!1;return l.style.display="none",t.noDom||u.appendChild(l),{subscribeTo:a,element:e,setMessageOptions:i,dispose:c}},nod.makeEventEmitter=function(e){function n(e){if(!CustomEvent)throw"nod.validate tried to fire a custom event, but the browser does not support CustomEvent's";r=new CustomEvent("nod.validation",{detail:e}),e.element.dispatchEvent(r)}function t(t){e.subscribe(t,n)}var r;return{subscribe:t}},nod.getElement=function(e){return nod.getElements(e)[0]},nod.getElements=function(e){if(!e)return[];if("string"==typeof e){if(window.jQuery)return window.jQuery(e).get();var n=document.querySelectorAll(e);return[].map.call(n,function(e){return e})}if(e.jquery)return e.get();if(1===e.nodeType)return[e];if(Array.isArray(e)){var t=[];return e.forEach(function(e){var n=nod.getElements(e);t=t.concat(n)}),t}throw"Unknown type of elements in your `selector`: "+e},nod.getCheckFunction=function(e){if("function"==typeof e.validate)return e.validate;if(e.validate instanceof RegExp)return nod.checkFunctions.regexp(e.validate);var n=e.validate.split(":"),t=n.shift();if(("one-of"===t||"only-one-of"===t||"same-as"===t||"some-radio"===t)&&n.push(e.selector),"function"==typeof nod.checkFunctions[t])return nod.checkFunctions[t].apply(null,n);throw"Couldn't find your validator function \""+t+'" for "'+e.selector+'"'},nod.checkFunctions={presence:function(){return function(e,n){e(n.length>0)}},exact:function(e){return function(n,t){n(t===e)}},contains:function(e){return function(n,t){n(t.indexOf(e)>-1)}},not:function(e){return function(n,t){n(t!==e)}},"min-length":function(e){return function(n,t){n(t.length>=e)}},"max-length":function(e){return function(n,t){n(t.length<=e)}},"exact-length":function(e){return function(n,t){n(t.length===+e)}},"between-length":function(e,n){return function(t,r){t(r.length>=e&&r.length<=n)}},"max-number":function(e){return function(n,t){n(e>=+t)}},"min-number":function(e){return function(n,t){n(e>=+t)}},"between-number":function(e,n){return function(t,r){t(+r>=e&&n>=+r)}},integer:function(){return function(e,n){e(/^\s*\d+\s*$/.test(n))}},"float":function(){return function(e,n){e(/^[-+]?[0-9]+(\.[0-9]+)?$/.test(n))}},"same-as":function(e){var n=nod.getElement(e);return function(e,t,r){r&&r.event&&r.event.target&&r.event.target!==r.element&&0===t.length||e(t===n.value)}},"one-of":function(e){function n(){return t.reduce(function(e,n){return e+""+(n.value||"")},"")}var t=nod.getElements(e);return function(e){e(n().trim().length>0)}},"only-one-of":function(e){var n=nod.getElements(e);return function(e){var t=0;n.forEach(function(e){e.value&&t++}),e(1===t)}},checked:function(){return function(e,n,t){e(t.element.checked)}},"some-radio":function(e){var n=nod.getElements(e);return function(e,t,r){var o=n.reduce(function(e){return e||r.element.checked},!1);e(o)}},regexp:function(e){return function(n,t){n(e.test(t))}},email:function(){var e=/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/;return function(n,t){n(e.test(t))}}};